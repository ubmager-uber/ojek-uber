<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OJEK UBER - UB MAGER</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    
    <style>
        /* ========== CSS VARIABLES ========== */
        :root {
            --yellow-primary: #fbd118;
            --yellow-hover: #e0a800;
            --yellow-dark: #d19900;
            --blue-dark: #0c1a3e;
            --blue-accent: #3d70cb;
            --red-accent: #e13f52;
            --white: #ffffff;
            --gray-50: #f8f9fa;
            --gray-100: #e9ecef;
            --gray-200: #dee2e6;
            --gray-700: #495057;
            --gray-900: #212529;
            --green-success: #25d366;
            --red-error: #dc3545;
            --orange-warning: #fd7e14;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
            --transition-base: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--blue-dark) 0%, #1a2847 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ========== PREMIUM ANIMATED HEADER ========== */
        .header {
            background: linear-gradient(135deg, #ffd700 0%, #fbc02d 50%, #f9a825 100%);
            padding: 2.5rem 1rem;
            text-align: center;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .header::before,
        .header::after {
            content: '';
            position: absolute;
            width: 300%;
            height: 300%;
            top: -100%;
            left: -100%;
            z-index: 0;
            opacity: 0.4;
        }

        .header::before {
            background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, transparent 60%);
            animation: wave1 6s ease-in-out infinite;
        }

        .header::after {
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 50%);
            animation: wave2 8s ease-in-out infinite reverse;
        }

        @keyframes wave1 {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(10%, -10%) rotate(90deg) scale(1.1); }
            50% { transform: translate(-10%, 10%) rotate(180deg) scale(1); }
            75% { transform: translate(10%, 10%) rotate(270deg) scale(1.1); }
        }

        @keyframes wave2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            33% { transform: translate(-10%, 10%) rotate(120deg) scale(1.15); }
            66% { transform: translate(10%, -10%) rotate(240deg) scale(1); }
        }

        .header-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 5s ease-in-out infinite;
            width: 6px;
            height: 6px;
        }

        .particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 30%; top: 60%; animation-delay: 1s; }
        .particle:nth-child(3) { left: 50%; top: 30%; animation-delay: 2s; }
        .particle:nth-child(4) { left: 70%; top: 70%; animation-delay: 1.5s; }
        .particle:nth-child(5) { left: 90%; top: 40%; animation-delay: 0.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.7; }
            50% { transform: translateY(-40px) scale(1.3); opacity: 1; }
        }

        @media (max-width: 768px) {
            .particle {
                width: 10px;
                height: 10px;
            }
            
            @keyframes float {
                0%, 100% { transform: translateY(0) scale(1); opacity: 0.8; }
                50% { transform: translateY(-60px) scale(1.5); opacity: 1; }
            }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            letter-spacing: 0.15em;
            position: relative;
            display: inline-block;
        }

        .header h1 .text-gradient {
            background: linear-gradient(135deg, 
                var(--blue-dark) 0%, 
                #1a2847 25%, 
                var(--blue-dark) 50%, 
                #0f1729 75%, 
                var(--blue-dark) 100%
            );
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(251, 209, 24, 0.6),
                         0 0 20px rgba(251, 209, 24, 0.4);
            animation: shimmer 4s ease-in-out infinite,
                       textPulse 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes textPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.03); filter: brightness(1.1); }
        }

        .header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--blue-dark);
            opacity: 0.9;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 0.05em;
        }

        .header-instagram {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 700;
            color: var(--blue-dark);
            text-decoration: none;
            transition: var(--transition-base);
            box-shadow: var(--shadow-md);
        }

        .header-instagram:hover {
            background: rgba(255,255,255,0.7);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .instagram-icon {
            width: 22px;
            height: 22px;
        }

        /* ========== ASSISTIVE TOUCH ========== */
        .assistive-touch {
            position: fixed;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd700, #fbc02d);
            border-radius: 50%;
            bottom: 80px;
            right: 20px;
            z-index: 9998;
            cursor: move;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            touch-action: none;
        }

        .assistive-touch:hover {
            transform: scale(1.1);
        }

        .assistive-touch svg {
            width: 26px;
            height: 26px;
            color: var(--blue-dark);
        }

        /* ========== COMPACT TUTORIAL MODAL ========== */
        .tutorial-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            animation: fadeIn 0.3s ease;
        }

        .tutorial-modal.hidden {
            display: none;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(12, 26, 62, 0.9);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideUp 0.4s ease;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--gray-100);
            font-size: 22px;
            cursor: pointer;
            transition: var(--transition-base);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--gray-200);
            transform: rotate(90deg);
        }

        .modal-header {
            padding: 1.5rem 1.5rem 1rem;
            text-align: center;
            background: linear-gradient(135deg, var(--yellow-primary) 0%, var(--yellow-hover) 100%);
            border-radius: 20px 20px 0 0;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--blue-dark);
            margin-bottom: 0.3rem;
        }

        .modal-header p {
            font-size: 0.9rem;
            color: var(--blue-dark);
            opacity: 0.85;
        }

        .modal-body {
            padding: 1.25rem;
        }

        .step {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding: 0.875rem;
            border-radius: 10px;
            background: var(--gray-50);
            transition: var(--transition-base);
        }

        .step:hover {
            background: var(--gray-100);
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--yellow-primary), var(--yellow-hover));
            color: var(--blue-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .step-content h3 {
            font-size: 0.95rem;
            color: var(--blue-dark);
            margin-bottom: 0.2rem;
        }

        .step-content p {
            font-size: 0.825rem;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .modal-footer {
            padding: 1rem 1.5rem 1.5rem;
            text-align: center;
        }

        .modal-cta {
            background: linear-gradient(135deg, var(--blue-accent) 0%, #2557a7 100%);
            color: white;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            box-shadow: var(--shadow-md);
        }

        .modal-cta:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        @media (max-width: 768px) {
            .modal-content {
                margin: 0 10px;
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 1.25rem 1rem 0.875rem;
            }
            
            .modal-header h2 {
                font-size: 1.3rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .step {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }
            
            .step-number {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            
            .step-content h3 {
                font-size: 0.875rem;
            }
            
            .step-content p {
                font-size: 0.775rem;
                line-height: 1.3;
            }
        }

        /* REST OF CSS (Container, Card, Form, Map, Buttons, Toast) */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 3rem 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition-base);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--blue-accent);
            box-shadow: 0 0 0 3px rgba(61, 112, 203, 0.1);
        }

        .input-group {
            position: relative;
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .paste-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            background: var(--gray-100);
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .paste-btn:hover {
            background: var(--gray-200);
            transform: translateY(-50%) scale(1.1);
        }

        .gmaps-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #4285f4 100%);
            background-size: 200% 200%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            animation: gmapsGradient 3s ease infinite;
            position: relative;
        }

        @keyframes gmapsGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .gmaps-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-md);
        }

        #mainMap {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition-base);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--yellow-primary) 0%, var(--yellow-hover) 100%);
            color: var(--blue-dark);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-success {
            background: var(--green-success);
            color: white;
        }

        .btn-success:hover {
            background: #1fb855;
            transform: translateY(-2px);
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(12, 26, 62, 0.3);
            border-top-color: var(--blue-dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .result-section {
            display: none;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
        }

        .result-section.show {
            display: block;
            animation: slideDown 0.4s ease;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .result-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--gray-200);
            transition: var(--transition-base);
        }

        .result-card:hover {
            border-color: var(--blue-accent);
            transform: translateY(-4px);
        }

        .result-value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .result-value.distance {
            color: var(--blue-accent);
        }

        .result-value.cost {
            color: var(--green-success);
        }

        .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            background: white;
            cursor: pointer;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.4s ease;
        }

        .toast.error { border-left: 4px solid var(--red-error); }
        .toast.success { border-left: 4px solid var(--green-success); }
        .toast.warning { border-left: 4px solid var(--orange-warning); }

        .leaflet-routing-container {
            display: none !important;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .header h2 { font-size: 1.1rem; }
            .container { padding: 1.5rem 1rem; }
            #mainMap { height: 300px; }
            .result-grid { grid-template-columns: 1fr; }
        }
    </style>
</head><body>
    <!-- Assistive Touch Button -->
    <div class="assistive-touch" id="assistiveTouch" title="Buka Panduan">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
    </div>

    <!-- Compact Tutorial Modal -->
    <div class="tutorial-modal" id="tutorialModal">
        <div class="modal-overlay" onclick="closeTutorial()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeTutorial()">×</button>
            
            <div class="modal-header">
                <h2>Cara Memesan Ojek UBER</h2>
                <p>Panduan singkat & mudah</p>
            </div>
            
            <div class="modal-body">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Buka Google Maps</h3>
                        <p>Ketuk tombol peta warna-warni di samping kolom input</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Cari Lokasi Penjemputan</h3>
                        <p>Ketik alamat/nama tempat → Ketuk hasil pencarian untuk menandai di peta</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Salin Link dari Google Maps</h3>
                        <p>Ketuk tombol "Bagikan" → Pilih "Salin Link" → Tempel di kolom penjemputan</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Ulangi untuk Lokasi Tujuan</h3>
                        <p>Lakukan langkah yang sama (langkah 2 & 3) untuk menentukan titik tujuan Anda</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h3>Hitung Tarif & Pesan</h3>
                        <p>Klik "Hitung Tarif" → Lihat jarak & harga → Pilih pembayaran → Pesan via WhatsApp</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-cta" onclick="closeTutorial()">Mengerti, Mulai Pesan!</button>
            </div>
        </div>
    </div>

    <!-- Header with Premium Animated Background -->
    <header class="header">
        <div class="header-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
        <div class="header-content">
            <h1><span class="text-gradient">OJEK UBER</span></h1>
            <h2>(UB MAGER)</h2>
            <a href="https://instagram.com/uber.mlg" target="_blank" class="header-instagram">
                <svg class="instagram-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
                @uber.mlg
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div class="card">
            <form id="orderForm">
                <!-- Nama Pemesan -->
                <div class="form-group">
                    <label class="form-label" for="name">Nama Pemesan</label>
                    <input 
                        type="text" 
                        id="name" 
                        class="form-input" 
                        placeholder="Masukkan nama Anda" 
                        required 
                        style="padding-right: 1rem;"
                    />
                </div>

                <!-- Titik Penjemputan -->
                <div class="form-group">
                    <label class="form-label" for="pickupLink">
                        <svg class="map-icon" style="display: inline-block; vertical-align: middle; margin-right: 4px; width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="#3d70cb" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Titik Penjemputan
                    </label>
                    <div class="input-group">
                        <div class="input-wrapper">
                            <input 
                                type="text" 
                                id="pickupLink" 
                                class="form-input" 
                                placeholder="Tempel link Google Maps di sini (Tap & Hold → Paste)" 
                                required 
                            />
                            <button 
                                type="button" 
                                class="paste-btn" 
                                onclick="pasteFromClipboard('pickupLink')"
                                title="Paste dari clipboard"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 18px; height: 18px;">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                            </button>
                        </div>
                        <button 
                            type="button" 
                            class="gmaps-btn" 
                            onclick="openGoogleMaps()"
                            title="Buka Google Maps"
                        >
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 24px; height: 24px; position: relative; z-index: 1;">
                                <path fill="#4285F4" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                                <circle fill="#fff" cx="12" cy="9" r="2.5"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Titik Tujuan -->
                <div class="form-group">
                    <label class="form-label" for="destinationLink">
                        <svg class="map-icon" style="display: inline-block; vertical-align: middle; margin-right: 4px; width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="#e13f52" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Titik Tujuan
                    </label>
                    <div class="input-group">
                        <div class="input-wrapper">
                            <input 
                                type="text" 
                                id="destinationLink" 
                                class="form-input" 
                                placeholder="Tempel link Google Maps di sini (Tap & Hold → Paste)" 
                                required 
                            />
                            <button 
                                type="button" 
                                class="paste-btn" 
                                onclick="pasteFromClipboard('destinationLink')"
                                title="Paste dari clipboard"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 18px; height: 18px;">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                            </button>
                        </div>
                        <button 
                            type="button" 
                            class="gmaps-btn" 
                            onclick="openGoogleMaps()"
                            title="Buka Google Maps"
                        >
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 24px; height: 24px; position: relative; z-index: 1;">
                                <path fill="#EA4335" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                                <circle fill="#fff" cx="12" cy="9" r="2.5"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Peta Monitor -->
                <div class="map-wrapper">
                    <div class="map-label" style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--blue-dark); margin-bottom: 0.75rem;">
                        <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                            <line x1="8" y1="2" x2="8" y2="18"></line>
                            <line x1="16" y1="6" x2="16" y2="22"></line>
                        </svg>
                        Peta Monitor Rute
                    </div>
                    <div id="mainMap"></div>
                    <div class="map-instruction" id="mapInstruction" style="text-align: center; padding: 0.75rem; background: var(--gray-50); border-radius: 8px; margin-top: 0.75rem; font-size: 0.9rem;">
                        Rute akan ditampilkan setelah Anda klik "Hitung Tarif"
                    </div>
                </div>

                <!-- Tombol Hitung Tarif -->
                <button type="button" class="btn btn-primary" id="calculateBtn" onclick="calculateFare()">
                    Hitung Tarif
                </button>

                <!-- Hasil Perhitungan -->
                <div class="result-section" id="resultSection">
                    <div style="text-align: center; font-size: 1.1rem; font-weight: 600; color: var(--blue-dark); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                        Hasil Perhitungan
                    </div>
                    <div class="result-grid">
                        <div class="result-card">
                            <div style="font-size: 0.875rem; color: var(--gray-700); margin-bottom: 0.5rem; font-weight: 500;">Jarak Tempuh</div>
                            <div class="result-value distance" id="distanceDisplay">0 km</div>
                        </div>
                        <div class="result-card">
                            <div style="font-size: 0.875rem; color: var(--gray-700); margin-bottom: 0.5rem; font-weight: 500;">Total Tarif</div>
                            <div class="result-value cost" id="costDisplay">Rp 0</div>
                        </div>
                    </div>
                </div>

                <!-- Hidden inputs -->
                <input type="hidden" id="distance" />
                <input type="hidden" id="cost" />
                <input type="hidden" id="pickupLat" />
                <input type="hidden" id="pickupLng" />
                <input type="hidden" id="destLat" />
                <input type="hidden" id="destLng" />

                <!-- Metode Pembayaran -->
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label" for="payment">Metode Pembayaran</label>
                    <select id="payment" class="form-select" required>
                        <option value="Tunai">Tunai</option>
                        <option value="QRIS">QRIS</option>
                    </select>
                </div>

                <!-- Tombol Pesan WhatsApp -->
                <button type="button" class="btn btn-success" id="waButton" onclick="sendToWhatsApp()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                    Pesan Sekarang via WhatsApp
                </button>
            </form>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <script>
        // ========== CONFIG - GANTI NGROK URL DI SINI ==========
        const CONFIG = {
            BACKEND_URL: 'https://subliminally-nonexpansive-sheryl.ngrok-free.app',  // GANTI INI!
            WA_NUMBER: '6287717392285',
            MAP_CENTER: [-7.955, 112.614],
            MAP_ZOOM: 13,
            TARIFF: {
                MIN_DISTANCE: 2.5,
                FLAT_RATE: 5000,
                RATE_PER_KM: 2000
            }
        };

        let map = null;
        let pickupMarker = null;
        let destinationMarker = null;
        let routingControl = null;

        const pickupIcon = L.icon({
            iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 41" width="25" height="41">
                    <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 6.9 12.5 28.5 12.5 28.5s12.5-21.6 12.5-28.5C25 5.6 19.4 0 12.5 0z" fill="#3d70cb"/>
                    <circle cx="12.5" cy="12.5" r="7" fill="white"/>
                    <circle cx="12.5" cy="12.5" r="4" fill="#3d70cb"/>
                </svg>
            `),
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34]
        });

        const destinationIcon = L.icon({
            iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 41" width="25" height="41">
                    <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 6.9 12.5 28.5 12.5 28.5s12.5-21.6 12.5-28.5C25 5.6 19.4 0 12.5 0z" fill="#e13f52"/>
                    <circle cx="12.5" cy="12.5" r="7" fill="white"/>
                    <circle cx="12.5" cy="12.5" r="4" fill="#e13f52"/>
                </svg>
            `),
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34]
        });

        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            showTutorial();
            initializeAssistiveTouch();
        });

        function initializeMap() {
            try {
                map = L.map('mainMap', {
                    zoomControl: true,
                    attributionControl: true
                }).setView(CONFIG.MAP_CENTER, CONFIG.MAP_ZOOM);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap',
                    maxZoom: 19
                }).addTo(map);
            } catch (error) {
                console.error('Map error:', error);
            }
        }

        function initializeAssistiveTouch() {
            const assistiveTouch = document.getElementById('assistiveTouch');
            let isDragging = false;
            let startX, startY, startLeft, startTop;

            assistiveTouch.addEventListener('mousedown', startDrag);
            assistiveTouch.addEventListener('touchstart', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);

            function startDrag(e) {
                isDragging = true;
                const touch = e.type === 'touchstart' ? e.touches[0] : e;
                startX = touch.clientX;
                startY = touch.clientY;
                startLeft = assistiveTouch.offsetLeft;
                startTop = assistiveTouch.offsetTop;
                assistiveTouch.style.transition = 'none';
                e.preventDefault();
            }

            function drag(e) {
                if (!isDragging) return;
                const touch = e.type === 'touchmove' ? e.touches[0] : e;
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;
                let newLeft = startLeft + deltaX;
                let newTop = startTop + deltaY;
                const maxLeft = window.innerWidth - assistiveTouch.offsetWidth;
                const maxTop = window.innerHeight - assistiveTouch.offsetHeight;
                newLeft = Math.max(0, Math.min(newLeft, maxLeft));
                newTop = Math.max(0, Math.min(newTop, maxTop));
                assistiveTouch.style.left = newLeft + 'px';
                assistiveTouch.style.top = newTop + 'px';
                assistiveTouch.style.right = 'auto';
                assistiveTouch.style.bottom = 'auto';
                e.preventDefault();
            }

            function endDrag(e) {
                if (!isDragging) return;
                isDragging = false;
                assistiveTouch.style.transition = 'transform 0.2s ease';
                const touch = e.type === 'touchend' ? e.changedTouches[0] : e;
                const distance = Math.sqrt(Math.pow(touch.clientX - startX, 2) + Math.pow(touch.clientY - startY, 2));
                if (distance < 5) showTutorial();
            }
        }

        function showTutorial() {
            document.getElementById('tutorialModal').classList.remove('hidden');
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').classList.add('hidden');
        }

        function openGoogleMaps() {
            window.open('https://maps.google.com', '_blank');
        }

        async function pasteFromClipboard(inputId) {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById(inputId).value = text;
                showToast('success', 'Berhasil!', 'Link berhasil di-paste.');
            } catch (error) {
                showToast('warning', 'Paste Manual', 'Silakan paste manual dengan Tap & Hold → Paste.');
            }
        }

        async function calculateFare() {
            const pickupLink = document.getElementById('pickupLink').value.trim();
            const destinationLink = document.getElementById('destinationLink').value.trim();

            if (!pickupLink || !destinationLink) {
                showToast('warning', 'Data Belum Lengkap', 'Mohon isi link penjemputan dan tujuan.');
                return;
            }

            const calculateBtn = document.getElementById('calculateBtn');
            const originalText = calculateBtn.innerHTML;
            calculateBtn.disabled = true;
            calculateBtn.innerHTML = '<span class="spinner"></span> Memproses...';

            try {
                const sessionId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

                console.log('Sending to:', `${CONFIG.BACKEND_URL}/api/convert-gmaps`);

                const response = await fetch(`${CONFIG.BACKEND_URL}/api/convert-gmaps`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        links: [pickupLink, destinationLink]
                    })
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                console.log('Response data:', data);

                if (data.status !== 'success' || !data.results || data.results.length !== 2) {
                    throw new Error('Gagal mengkonversi link');
                }

                const pickupCoords = data.results[0];
                const destCoords = data.results[1];

                if (pickupCoords.status !== 'success' || destCoords.status !== 'success') {
                    throw new Error('Link tidak valid');
                }

                document.getElementById('pickupLat').value = pickupCoords.lat;
                document.getElementById('pickupLng').value = pickupCoords.lng;
                document.getElementById('destLat').value = destCoords.lat;
                document.getElementById('destLng').value = destCoords.lng;

                displayRoute(pickupCoords, destCoords);
                showToast('success', 'Berhasil!', 'Rute berhasil dihitung.');

            } catch (error) {
                console.error('Calculate error:', error);
                showToast('error', 'Gagal Memproses', error.message);
            } finally {
                calculateBtn.disabled = false;
                calculateBtn.innerHTML = originalText;
            }
        }

        function displayRoute(pickupCoords, destCoords) {
            if (pickupMarker) map.removeLayer(pickupMarker);
            if (destinationMarker) map.removeLayer(destinationMarker);
            if (routingControl) map.removeControl(routingControl);

            const pickupLatLng = L.latLng(pickupCoords.lat, pickupCoords.lng);
            pickupMarker = L.marker(pickupLatLng, { icon: pickupIcon }).addTo(map).bindPopup('Penjemputan');

            const destLatLng = L.latLng(destCoords.lat, destCoords.lng);
            destinationMarker = L.marker(destLatLng, { icon: destinationIcon }).addTo(map).bindPopup('Tujuan');

            routingControl = L.Routing.control({
                waypoints: [pickupLatLng, destLatLng],
                routeWhileDragging: false,
                addWaypoints: false,
                createMarker: function() { return null; },
                show: false,
                lineOptions: { styles: [{ color: '#FF0000', weight: 5, opacity: 0.8 }] }
            }).on('routesfound', function(e) {
                const summary = e.routes[0].summary;
                const distance = (summary.totalDistance / 1000).toFixed(2);

                let fare;
                if (parseFloat(distance) < CONFIG.TARIFF.MIN_DISTANCE) {
                    fare = CONFIG.TARIFF.FLAT_RATE;
                } else {
                    fare = Math.ceil(parseFloat(distance) * CONFIG.TARIFF.RATE_PER_KM);
                }

                document.getElementById('distance').value = distance;
                document.getElementById('cost').value = fare;
                document.getElementById('distanceDisplay').textContent = `${distance} km`;
                document.getElementById('costDisplay').textContent = `Rp ${fare.toLocaleString('id-ID')}`;
                document.getElementById('resultSection').classList.add('show');
                document.getElementById('mapInstruction').textContent = `✓ Rute: ${distance} km - Rp ${fare.toLocaleString('id-ID')}`;

                map.fitBounds(L.latLngBounds(pickupLatLng, destLatLng), { padding: [50, 50] });
            }).addTo(map);
        }

        async function sendToWhatsApp() {
            const name = document.getElementById('name').value.trim();
            const payment = document.getElementById('payment').value;
            const distance = document.getElementById('distance').value;
            const cost = document.getElementById('cost').value;
            const pickupLat = document.getElementById('pickupLat').value;
            const pickupLng = document.getElementById('pickupLng').value;
            const destLat = document.getElementById('destLat').value;
            const destLng = document.getElementById('destLng').value;

            if (!name) {
                showToast('warning', 'Nama Belum Diisi', 'Mohon isi nama Anda.');
                return;
            }

            if (!distance || !cost) {
                showToast('warning', 'Belum Hitung Tarif', 'Klik "Hitung Tarif" terlebih dahulu.');
                return;
            }

            const pickupLink = `https://maps.google.com/?q=${pickupLat},${pickupLng}`;
            const destLink = `https://maps.google.com/?q=${destLat},${destLng}`;

            let message = `Halo admin, saya *${name}* ingin memesan Ojek UBER:\n\n`;
            message += `Titik Penjemputan:\n${pickupLink}\n\n`;
            message += `Titik Tujuan:\n${destLink}\n\n`;
            message += `Jarak: *${distance} km*\n`;
            message += `Total Tarif: *Rp ${parseInt(cost).toLocaleString('id-ID')}*\n`;
            message += `Metode Pembayaran: *${payment}*`;

            const waUrl = `https://wa.me/${CONFIG.WA_NUMBER}?text=${encodeURIComponent(message)}`;

            try {
                await fetch(`${CONFIG.BACKEND_URL}/api/submit-order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nama: name,
                        linkPenjemputan: pickupLink,
                        linkTujuan: destLink,
                        jarak: distance,
                        tarif: cost,
                        metodePembayaran: payment,
                        timestamp: new Date().toISOString()
                    })
                });
            } catch (error) {
                console.error('Submit error:', error);
            }

            window.location.href = waUrl;
        }

        function showToast(type, title, message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            let iconSvg = '';
            if (type === 'error') {
                iconSvg = '<svg style="width: 24px; height: 24px; flex-shrink: 0;" viewBox="0 0 24 24" fill="none" stroke="#dc3545" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
            } else if (type === 'success') {
                iconSvg = '<svg style="width: 24px; height: 24px; flex-shrink: 0;" viewBox="0 0 24 24" fill="none" stroke="#25d366" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
            } else if (type === 'warning') {
                iconSvg = '<svg style="width: 24px; height: 24px; flex-shrink: 0;" viewBox="0 0 24 24" fill="none" stroke="#fd7e14" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
            }

            toast.innerHTML = `
                ${iconSvg}
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--blue-dark); margin-bottom: 0.25rem;">${title}</div>
                    <div style="font-size: 0.875rem; color: var(--gray-700);">${message}</div>
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">×</button>
            `;
            toast.style.display = 'flex';
            toast.style.alignItems = 'center';
            toast.style.gap = '1rem';

            document.body.appendChild(toast);

            setTimeout(() => {
                if (toast.parentElement) toast.remove();
            }, 5000);
        }

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
